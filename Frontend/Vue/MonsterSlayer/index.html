<!DOCTYPE html>
<html>
  <head>
    <title>Monster Slayer</title>
    <script src="https://npmcdn.com/vue/dist/vue.js"></script>
    <link rel="stylesheet" href="css/foundation.min.css" />
    <link rel="stylesheet" href="css/app.css" />
  </head>
  <body>
    <div id="app">
      <section class="row">
        <div class="small-6 columns">
          <h1 class="text-center">YOU</h1>
          <div class="healthbar">
            <div
              class="healthbar text-center"
              style="background-color: green; margin: 0; color: white"
              :style="{ width: `${myHealth}%` }"
            >
              {{ myHealth }}
            </div>
          </div>
        </div>
        <div class="small-6 columns">
          <h1 class="text-center">MONSTER</h1>
          <div class="healthbar">
            <div
              class="healthbar text-center"
              style="background-color: green; margin: 0; color: white"
              :style="{ width: `${monsterHealth}%` }"
            >
              {{monsterHealth}}
            </div>
          </div>
        </div>
      </section>
      <section class="row controls">
        <div class="small-12 columns">
          <button @click="newGame" id="start-game">START NEW GAME</button>
        </div>
      </section>
      <section v-if="gameStart" class="row controls">
        <div class="small-12 columns">
          <button @click="attack" id="attack">ATTACK</button>
          <button @click="specialAttack" id="special-attack">
            SPECIAL ATTACK
          </button>
          <button @click="heal" id="heal">HEAL</button>
          <button @click="giveUp" id="give-up">GIVE UP</button>
        </div>
      </section>
      <section class="row log">
        <div class="small-12 columns">
          <ul>
            <li
              v-for="log in logs"
              :key="log.message"
              :class="`${log.player}-turn`"
            >
              {{ log.player }} {{ log.action }} {{ log.target }} FOR {{
              log.value }}
            </li>
          </ul>
        </div>
      </section>
    </div>
    <script>
      function randomWholeNumber (min, max) {
        const minimum = Math.ceil(min)
        const maximum = Math.floor(max)
        return Math.floor(Math.random() * (maximum - minimum + 1)) + minimum
      }
      new Vue({
        el: '#app',
        data: {
          myHealth: 50,
          monsterHealth: 50,
          logs: [],
          gameStart: true,
          winner: ''
        },
        watch: {
          myHealth: function (value) {
            if (value === 0) {
              this.gameStart = false
              this.winner = 'Monster'
            }
          },
          monsterHealth: function (val, oldValue) {
            if (val === 0) {
              this.gameStart = false
              this.winner = 'Player'
            }

            if (this.myHealth === 0) return

            if (this.myHealth < 9) {
              this.myHealth = 0
              return
            }
            const randomAttack = randomWholeNumber(5, 15)
            this.myHealth -= randomAttack
            this.logs.push({
              player: 'monster',
              value: randomAttack,
              action: 'attacks'
            })
          },
          gameStart: function (val) {
            if (!this.gameStart) {
              alert(`This ${this.winner} has won!`)
            }
          }
        },
        computer: {},
        methods: {
          attack () {
            if (this.monsterHealth === 0) return

            if (this.monsterHealth < 9) {
              this.monsterHealth = 0
              return
            }

            const randomAttack = randomWholeNumber(5, 10)

            this.monsterHealth -= randomAttack
            this.logs.push({
              player: 'player',
              value: randomAttack,
              action: 'attacks'
            })
          },
          giveUp () {
            const answer = window.confirm('Are you sure you want to give up?')
            if (answer) {
              this.myHealth = 0
              this.gameStart = false
              this.logs.push({
                player: 'monster',
                action: 'ate',
                target: 'player',
                value: 'giving up'
              })
            }
            return
          },
          specialAttack () {
            if (this.monsterHealth === 0) return

            if (this.monsterHealth < 9) {
              this.monsterHealth = 0
              return
            }

            const randomSpecialAttack = randomWholeNumber(1, 20)
            this.monsterHealth -= this.logs.push({
              player: 'player',
              value: randomSpecialAttack,
              action: 'smashes'
            })
          },
          heal () {
            if (this.myHealth === 100) return

            if (this.myHealth > 90 && this.myHealth < 100) {
              this.myHealth = 100
            }

            const healValue = 10
            this.myHealth += healValue
            this.logs.push({
              player: 'player',
              target: 'themselves',
              value: healValue,
              action: 'smashes'
            })
          },
          newGame () {
            const answer = window.confirm(
              'Are you sure you want to start a new game?'
            )
            if (answer) {
              this.gameStart = true
              this.myHealth = 100
              this.monsterHealth = 100
              this.logs = []
            }
            return
          }
        }
      })
    </script>
  </body>
</html>
